<?xml version="1.0" encoding="UTF-8"?>
<project name="sdr" basedir="." default="none">

<description>
Square Dance Revolution build file.
</description>

    <!-- set the classpath and properties -->
    <property name="top_dir"		value="."/>
    <property name="api_dir"            value="${top_dir}/api"/>
    <property name="lib_dir"            value="${top_dir}/lib"/>
    <property name="src_dir"            value="${top_dir}/src"/>
    <property name="classes_dir"	value="${top_dir}/bin"/>
    <property name="resources_dir"	value="${top_dir}/resources"/>

    <path id="classpath.path">
        <pathelement path="${classes_dir}"/>
	<fileset dir="lib">
	    <include name="*.jar" />
	    <include name="sphinx/*.jar" />
	    <include name="jme/*.jar" />
	</fileset>
    </path>

    <!-- define some variables for the script -->
    <target name="init">
    </target>

    <target name="none">
            <echo>Type 'ant -projecthelp' for possible targets.</echo>
    </target>

    <!-- delete generated files -->
    <target name="clean" depends="init"
            description="Removes the generated class files and javadoc">
	<delete dir="${classes_dir}" />
	<delete dir="${api_dir}" />
	<delete file="${top_dir}/${ant.project.name}.jar" />
    </target>

    <!-- compile the source code -->
    <target name="compile" depends="init"
            description="Compiles the code in ${src_dir} to ${classes_dir}">
    <antlr target="src/net/cscott/sdr/calls/transform/CallFile.g">
		<classpath refid="classpath.path" />
    </antlr>
    <antlr target="src/net/cscott/sdr/calls/transform/CallFileBuilder.g">
		<classpath refid="classpath.path" />
    </antlr>
	    <mkdir dir="${classes_dir}" />
	    <javac srcdir="${src_dir}"
		   destdir="${classes_dir}"
		   excludes="CVS"
		   deprecation="on" source="1.5" debug="true">
                   <compilerarg value="-Xlint:unchecked"/>
		   <classpath refid="classpath.path" />
	    </javac>
    </target>

    <!-- run the javadoc tool on the source code -->
    <target name="javadoc" depends="init"
            description="Generates javadoc in ${api_dir}">
	<mkdir dir="${api_dir}" />
	<javadoc sourcepath="${src_dir}"
		 packagenames="net.cscott.*"
		 destdir="${api_dir}"
		 doctitle="Square Dance Revolution!"
		 source="1.5"
		 windowtitle="${ant.project.name}">
		<classpath refid="classpath.path" />
            <link href="http://jakarta.apache.org/commons/lang/api-release/"/>
            <link href="http://cmusphinx.sourceforge.net/sphinx4/javadoc/"/>
            <link href="http://www.jmonkeyengine.com/doc/"/>
            <link href="http://cscott.net/Projects/JUtil/jutil-latest/doc/"/>
            <link href="http://java.sun.com/products/java-media/speech/forDevelopers/jsapi-doc/"/>
            <link href="http://java.sun.com/javase/6/docs/api"/>
            <link href="http://www.antlr.org/javadoc/"/>
	</javadoc>
    </target>

    <!-- export the project as a jar -->
    <target name="jar" depends="compile"
            description="Exports the project as a jar">
	<jar destfile="${top_dir}/${ant.project.name}.jar"
             update="true" manifest="${top_dir}/${ant.project.name}.Manifest"> 
		<fileset dir="${classes_dir}" />
		<fileset dir="${resources_dir}" />
	</jar>
    </target>

    <!-- most ant scripts have a build target -->
    <target name="build" depends="jar" description="Alias for jar target"/>

    <!-- ********************************************************** -->
    <!-- *                                                        * -->
    <!-- * Runs the application.                                  * -->
    <!-- *                                                        * -->
    <!-- ********************************************************** -->
    <target name="run"
	    description="Runs the application."
	    depends="jar">
	    <java jar="${top_dir}/${ant.project.name}.jar"
	          fork="true"
		  maxmemory="256m">
		  <sysproperty key="java.library.path" value="lib/jme"/>
                  <!--<sysproperty key="frontend" value="epFrontEnd"/>-->
		  <classpath refid="classpath.path"/>
	    </java>
    </target>

    <!-- ********* Build the natural-language grammars. ********* -->
    <target name="build.grm"
	    description="Build the natural-langauge grammars."
	    depends="jar">
	    <java classname="net.cscott.sdr.calls.grm.BuildGrammars"
	          fork="true">
                  <classpath>
                    <fileset dir=".">
                      <include name="sdr.jar"/>
                    </fileset>
		    <path refid="classpath.path"/>
                  </classpath>
	    </java>
<!--
java -cp lib/antlr-3.0b4.jar:lib/antlr-2.7.6.jar:lib/stringtemplate-2.3b9.jar:bin org.antlr.Tool -o . src/net/cscott/sdr/calls/lists/C4Grammar.3g
-->
	    <java classname="org.antlr.Tool"
	          fork="true">
		  <classpath refid="classpath.path"/>
		  <arg value="-o" />
		  <arg path="." />
		  <arg value="src/net/cscott/sdr/calls/lists/C4Grammar.3g" />
	    </java>
	    <move file="src/net/cscott/sdr/calls/lists/C4Parser.lexer.g"
	        tofile="src/net/cscott/sdr/calls/lists/C4Parser.lexer.3g" />
    </target>

</project>
